import './polyfills.server.mjs';
import{a as ie}from"./chunk-73V6T75T.mjs";import{a as f}from"./chunk-B36I7J6D.mjs";import{a as re}from"./chunk-K2TYXB5A.mjs";import"./chunk-YCM6RVGE.mjs";import{a as te}from"./chunk-Z2ZYBPIV.mjs";import"./chunk-B22Y7IUL.mjs";import{a as oe}from"./chunk-ZB5EWPKT.mjs";import{a as Z}from"./chunk-J55PHKJ5.mjs";import{a as ee}from"./chunk-4MMMLTFU.mjs";import{a as Y}from"./chunk-WSQWBVCP.mjs";import"./chunk-4WIUCPPE.mjs";import{a as l}from"./chunk-GLNDTVHY.mjs";import"./chunk-3XVMWW6Z.mjs";import{$d as V,Cc as R,Ec as j,Fa as n,Fc as w,Ga as a,Hd as z,Kb as I,Ma as d,Md as O,Nd as G,Od as x,Qe as X,Td as H,Va as c,ae as W,ce as U,de as L,ee as $,f as m,fe as q,ga as p,ge as J,hc as N,i as P,ie as Q,je as K,k as C,ka as s,lc as M,mc as F,na as D,nc as T,oc as E,p as y,qa as S,sc as k,v as h,vc as A,ya as u,yc as B}from"./chunk-S35L2QCG.mjs";import{a as _,b as v}from"./chunk-VT4PU2RR.mjs";var ne=class g extends oe{constructor(t,o,e,i,r,b,se){super(o,e,r);this.fb=t;this.productService=i;this.router=b;this.fileService=se}productForm;datas=[];isLoading=!1;searchButtonDisabled=!0;listError;isdelelete;ngOnInit(){this.buildForm(),this.loadProducts(),this.findProductProcess()}buildForm(){this.productForm=this.fb.group({id:[""],name:["",F.required],category:[""],barcode:[""],price:[""],stock:[""]})}columnMapping(){return{id:"ID",name:"Name",description:"Description",barcode:"Barcode",supplierName:"Supplier",sizes:"Sizes",expirationDate:"Expiration Date",manufacturingDate:"Manufacturing Date",pricing:"Pricing",inventory:"Inventory",category:"Category"}}loadProducts(){this.productService.product$.subscribe(t=>{this.processProductData(t),this.spinnerService.hide()})}processProductData(t){this.datas=this.customizePropertyNames(t,this.columnMapping()),this.setDefaultColumns(this.datas),this.datas&&this.datas.length>0?this.updateHasMorePagesT(!0):this.updateHasMorePagesT(!1)}checkInputs(){let t=this.productForm.get("id")?.value||"",o=this.productForm.get("name")?.value||"",e=this.productForm.get("category")?.value||"",i=this.productForm.get("barcode")?.value||"";this.searchButtonDisabled=!(t||o||e||i),this.searchButtonDisabled&&this.findProductProcess()}findProductProcess(){this.spinnerService.show();let t=this.productForm.value.id||"",o=this.productForm.value.name||"",e=this.productForm.value.category||"",i=this.productForm.value.barcode||"";this.productService.findProducts(this.page,this.pageSize,t,o,e,i).pipe(P(r=>{let b=r?.payload||[];return this.customizePropertyNames(b,this.columnMapping())}),y(r=>(console.error("Error fetching employees:",r),m([])))).subscribe(r=>{this.datas=r,console.log("Data source page",this.datas),this.setDefaultColumns(this.datas),this.datas&&this.datas.length>0?this.updateHasMorePagesT(!0):this.updateHasMorePagesT(!1),this.spinnerService.hide()})}findByparameter(){this.listError=this.validateObjectID(),this.listError.length===0&&(this.productForm.get("id")?.markAsTouched(),this.page=l.page,this.pageSize=l.perPage,this.findProductProcess())}validateObjectID(){let t=this.productForm.get("id")?.value||"",o=[],e=f.isValidObjectId(t);return f.empty(t)||e||o.push("ID is not valid."),o}onNewClick(){this.router.navigate(["/support/product/detail","new"])}handleEditAction(t){if(!t?.data?.ID){console.warn("Invalid product data.");return}let o=t.data.ID;this.router.navigate(["support/product/detail",o])}handleDeleteAction(t){if(!t.data.ID){console.warn("Product ID missing.");return}let o=t.data.ID;this.spinnerService.show(),this.fileService.getCatalogImagen(l.tipoImagenCatalog,o).pipe(h(e=>{if(e&&e.length>0){debugger;let i=e.map(r=>this.fileService.deleteFile(r.id));return C(i)}return m([])}),h(()=>this.productService.deleteProduct(o))).subscribe({next:()=>{this.showSuccessMessage("Producto e im\xE1genes eliminados con \xE9xito","Success"),this.isdelelete=t,this.findProductProcess()},error:e=>{console.error("Error eliminando producto o im\xE1genes:",e),this.spinnerService.hide(),this.handleErrorResponseSaveOrUpdate(e)}})}deleting(t){this.dialogService.open(Z,{context:{rowData:v(_({},t.data),{typeDescription:"QUESTION",description:`"${t.data.Name}"?`})}}).onClose.subscribe(e=>{e==="deleteConfirmed"&&(this.handleDeleteAction(t),this.findProductProcess())})}static \u0275fac=function(o){return new(o||g)(s(R),s(Y),s(ee),s(re),s(Q),s(N),s(te))};static \u0275cmp=D({type:g,selectors:[["app-product"]],features:[S],decls:23,vars:6,consts:[[1,"form-container"],[3,"formGroup"],["multi","true"],["expanded","true"],[1,"form-grid"],["nbInput","","fullWidth","","type","text","placeholder","ID","formControlName","id",3,"input"],["nbInput","","fullWidth","","type","text","placeholder","Name","formControlName","name",3,"input"],["nbInput","","fullWidth","","type","text","placeholder","Category","formControlName","category",3,"input"],["nbInput","","fullWidth","","type","text","placeholder","Barcode","formControlName","barcode",3,"input"],[1,"button-container"],["nbButton","","status","primary",3,"click","disabled"],["nbButton","","status","success",3,"click"],[3,"pageChange","pageSizeChange","deleteAction","editAction","loadMoreData","noData","datas","defaultColumns","isdelelete","hasMorePages"]],template:function(o,e){o&1&&(n(0,"div",0)(1,"form",1)(2,"nb-accordion",2)(3,"nb-accordion-item",3)(4,"nb-accordion-item-header"),c(5," Product "),a(),n(6,"nb-accordion-item-body")(7,"div",4)(8,"input",5),d("input",function(){return e.checkInputs()}),a(),n(9,"input",6),d("input",function(){return e.checkInputs()}),a(),n(10,"input",7),d("input",function(){return e.checkInputs()}),a(),n(11,"input",8),d("input",function(){return e.checkInputs()}),a()(),n(12,"div",9)(13,"button",10),d("click",function(){return e.findByparameter()}),c(14," Search "),a(),n(15,"button",11),d("click",function(){return e.onNewClick()}),c(16," New "),a()()()()(),n(17,"nb-accordion",2)(18,"nb-accordion-item",3)(19,"nb-accordion-item-header"),c(20," Data Information "),a(),n(21,"nb-accordion-item-body")(22,"app-table-datasource",12),d("pageChange",function(r){return e.onPageChange(r)})("pageSizeChange",function(r){return e.onPageSizeChange(r)})("deleteAction",function(r){return e.deleting(r)})("editAction",function(r){return e.handleEditAction(r)})("loadMoreData",function(){return e.findProductProcess()})("noData",function(){return e.showNoDataMessage()}),a()()()()()()),o&2&&(p(),u("formGroup",e.productForm),p(12),u("disabled",e.searchButtonDisabled),p(9),u("datas",e.datas)("defaultColumns",e.defaultColumnsInput)("isdelelete",e.isdelelete)("hasMorePages",e.hasMorePagesT))},dependencies:[I,w,k,M,T,E,A,B,j,x,G,O,W,V,z,K,H,J,U,L,q,$,X,ie],styles:[".form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:16px}.button-container[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:12px;margin-top:16px}"]})};export{ne as ProductComponent};
