import{a as d}from"./chunk-DEYWHEGI.js";import{a as g}from"./chunk-3BLQDXDP.js";import{Eb as S,G as m,J as s,Qd as U,_ as f,k as c,n as l,p as u,pb as h,qb as b,sb as v,w as p}from"./chunk-5E6KOILT.js";var j=class i extends d{constructor(e,r,t,o){super();this.http=e;this.router=r;this.toastrService=t;this.platformId=o;this.isBrowser=h(this.platformId);let a=null;if(this.isBrowser){let n=localStorage.getItem("usuario");a=n?JSON.parse(n):null}this.currentUserSubject=new c(a),this.currentUser=this.currentUserSubject.asObservable()}currentUserSubject;currentUser;isBrowser;get getCurrentUserValue(){if(!this.currentUserSubject.value&&this.isBrowser){let e=localStorage.getItem("usuario");if(e){let r=JSON.parse(e);return this.currentUserSubject.next(r),r}}return this.currentUserSubject.value}login(e,r){return this.verifyCredentials(e,r).pipe(u(t=>{let o=t.payload.user;return o.access_token=t.payload.accessToken,this.currentUserSubject.next(o),this.isBrowser&&localStorage.setItem("token",t.payload.accessToken),o}),p(t=>(this.toastrService.danger("Login failed","Authentication Error"),l(()=>new Error("Login failed")))))}logout(){this.isBrowser&&(localStorage.removeItem("usuario"),localStorage.removeItem("token"),localStorage.clear()),this.currentUserSubject.next(null)}verifyCredentials(e,r){this.isBrowser&&localStorage.clear();let t=new b({Accept:"application/json","Content-Type":"application/json",email:e,password:r}),o=`${g.API_SEGURIDAD}/api/v1/auth/authenticate`;return this.http.post(o,{email:e,password:r},{headers:t})}clearUser(){this.isBrowser&&localStorage.clear(),this.currentUserSubject.next(null)}static \u0275fac=function(r){return new(r||i)(s(v),s(S),s(U),s(f))};static \u0275prov=m({token:i,factory:i.\u0275fac,providedIn:"root"})};export{j as a};
