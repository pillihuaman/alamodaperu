import{a as ie}from"./chunk-7TELWWLP.js";import{a as f}from"./chunk-YZLXWSIR.js";import{a as re}from"./chunk-SDDIV7YG.js";import"./chunk-6ZZGLH3B.js";import{a as te}from"./chunk-4ZJXKBZD.js";import"./chunk-GJEU6FZM.js";import{a as oe}from"./chunk-IGSJ74VS.js";import{a as Z}from"./chunk-J4WYP6TI.js";import{a as ee}from"./chunk-VVXZNI42.js";import{a as Y}from"./chunk-C4MTUD5M.js";import"./chunk-TVVRTYFL.js";import{a as l}from"./chunk-SM2U5EFL.js";import"./chunk-HUQJSXFI.js";import{$b as B,Da as n,E as h,Ea as a,Ge as X,Ka as d,Kb as N,Md as V,Nd as W,Ob as M,Pb as F,Qb as T,Rb as E,Rd as U,Sd as L,Ta as c,Td as $,Ud as q,Vb as k,Vd as J,Xd as Q,Yb as A,Yd as K,a as _,b as v,gc as R,ha as p,ic as j,jc as w,la as s,ld as z,o as m,oa as D,qd as O,r as P,rd as G,sa as S,sd as x,t as C,ub as I,wa as u,y,yd as H}from"./chunk-V3AJZABF.js";var ne=class g extends oe{constructor(t,o,e,i,r,b,se){super(o,e,r);this.fb=t;this.productService=i;this.router=b;this.fileService=se}productForm;datas=[];isLoading=!1;searchButtonDisabled=!0;listError;isdelelete;ngOnInit(){this.buildForm(),this.loadProducts(),this.findProductProcess()}buildForm(){this.productForm=this.fb.group({id:[""],name:["",F.required],category:[""],barcode:[""],price:[""],stock:[""]})}columnMapping(){return{id:"ID",name:"Name",description:"Description",barcode:"Barcode",supplierName:"Supplier",sizes:"Sizes",expirationDate:"Expiration Date",manufacturingDate:"Manufacturing Date",pricing:"Pricing",inventory:"Inventory",category:"Category"}}loadProducts(){this.productService.product$.subscribe(t=>{this.processProductData(t),this.spinnerService.hide()})}processProductData(t){this.datas=this.customizePropertyNames(t,this.columnMapping()),this.setDefaultColumns(this.datas),this.datas&&this.datas.length>0?this.updateHasMorePagesT(!0):this.updateHasMorePagesT(!1)}checkInputs(){let t=this.productForm.get("id")?.value||"",o=this.productForm.get("name")?.value||"",e=this.productForm.get("category")?.value||"",i=this.productForm.get("barcode")?.value||"";this.searchButtonDisabled=!(t||o||e||i),this.searchButtonDisabled&&this.findProductProcess()}findProductProcess(){this.spinnerService.show();let t=this.productForm.value.id||"",o=this.productForm.value.name||"",e=this.productForm.value.category||"",i=this.productForm.value.barcode||"";this.productService.findProducts(this.page,this.pageSize,t,o,e,i).pipe(P(r=>{let b=r?.payload||[];return this.customizePropertyNames(b,this.columnMapping())}),y(r=>(console.error("Error fetching employees:",r),m([])))).subscribe(r=>{this.datas=r,console.log("Data source page",this.datas),this.setDefaultColumns(this.datas),this.datas&&this.datas.length>0?this.updateHasMorePagesT(!0):this.updateHasMorePagesT(!1),this.spinnerService.hide()})}findByparameter(){this.listError=this.validateObjectID(),this.listError.length===0&&(this.productForm.get("id")?.markAsTouched(),this.page=l.page,this.pageSize=l.perPage,this.findProductProcess())}validateObjectID(){let t=this.productForm.get("id")?.value||"",o=[],e=f.isValidObjectId(t);return f.empty(t)||e||o.push("ID is not valid."),o}onNewClick(){this.router.navigate(["/support/product/detail","new"])}handleEditAction(t){if(!t?.data?.ID){console.warn("Invalid product data.");return}let o=t.data.ID;this.router.navigate(["support/product/detail",o])}handleDeleteAction(t){if(!t.data.ID){console.warn("Product ID missing.");return}let o=t.data.ID;this.spinnerService.show(),this.fileService.getCatalogImagen(l.tipoImagenCatalog,o).pipe(h(e=>{if(e&&e.length>0){let i=e.map(r=>this.fileService.deleteFile(r.id));return C(i)}return m([])}),h(()=>this.productService.deleteProduct(o))).subscribe({next:()=>{this.showSuccessMessage("Producto e im\xE1genes eliminados con \xE9xito","Success"),this.isdelelete=t,this.findProductProcess()},error:e=>{console.error("Error eliminando producto o im\xE1genes:",e),this.spinnerService.hide(),this.handleErrorResponseSaveOrUpdate(e)}})}deleting(t){this.dialogService.open(Z,{context:{rowData:v(_({},t.data),{typeDescription:"QUESTION",description:`"${t.data.Name}"?`})}}).onClose.subscribe(e=>{e==="deleteConfirmed"&&(this.handleDeleteAction(t),this.findProductProcess())})}static \u0275fac=function(o){return new(o||g)(s(R),s(Y),s(ee),s(re),s(Q),s(N),s(te))};static \u0275cmp=D({type:g,selectors:[["app-product"]],features:[S],decls:23,vars:6,consts:[[1,"form-container"],[3,"formGroup"],["multi","true"],["expanded","true"],[1,"form-grid"],["nbInput","","fullWidth","","type","text","placeholder","ID","formControlName","id",3,"input"],["nbInput","","fullWidth","","type","text","placeholder","Name","formControlName","name",3,"input"],["nbInput","","fullWidth","","type","text","placeholder","Category","formControlName","category",3,"input"],["nbInput","","fullWidth","","type","text","placeholder","Barcode","formControlName","barcode",3,"input"],[1,"button-container"],["nbButton","","status","primary",3,"click","disabled"],["nbButton","","status","success",3,"click"],[3,"pageChange","pageSizeChange","deleteAction","editAction","loadMoreData","noData","datas","defaultColumns","isdelelete","hasMorePages"]],template:function(o,e){o&1&&(n(0,"div",0)(1,"form",1)(2,"nb-accordion",2)(3,"nb-accordion-item",3)(4,"nb-accordion-item-header"),c(5," Product "),a(),n(6,"nb-accordion-item-body")(7,"div",4)(8,"input",5),d("input",function(){return e.checkInputs()}),a(),n(9,"input",6),d("input",function(){return e.checkInputs()}),a(),n(10,"input",7),d("input",function(){return e.checkInputs()}),a(),n(11,"input",8),d("input",function(){return e.checkInputs()}),a()(),n(12,"div",9)(13,"button",10),d("click",function(){return e.findByparameter()}),c(14," Search "),a(),n(15,"button",11),d("click",function(){return e.onNewClick()}),c(16," New "),a()()()()(),n(17,"nb-accordion",2)(18,"nb-accordion-item",3)(19,"nb-accordion-item-header"),c(20," Data Information "),a(),n(21,"nb-accordion-item-body")(22,"app-table-datasource",12),d("pageChange",function(r){return e.onPageChange(r)})("pageSizeChange",function(r){return e.onPageSizeChange(r)})("deleteAction",function(r){return e.deleting(r)})("editAction",function(r){return e.handleEditAction(r)})("loadMoreData",function(){return e.findProductProcess()})("noData",function(){return e.showNoDataMessage()}),a()()()()()()),o&2&&(p(),u("formGroup",e.productForm),p(12),u("disabled",e.searchButtonDisabled),p(9),u("datas",e.datas)("defaultColumns",e.defaultColumnsInput)("isdelelete",e.isdelelete)("hasMorePages",e.hasMorePagesT))},dependencies:[I,w,k,M,T,E,A,B,j,x,G,O,W,V,z,K,H,J,U,L,q,$,X,ie],styles:[".form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:16px}.button-container[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:12px;margin-top:16px}"]})};export{ne as ProductComponent};
