import{a as d}from"./chunk-DEYWHEGI.js";import{a as g}from"./chunk-2WTVL4SE.js";import{C as i,T as f,eb as h,fb as v,gb as b,j as c,l,n as u,s as p,sb as S,sd as U,z as m}from"./chunk-AQOSOR55.js";var j=class s extends d{constructor(e,r,t,o){super();this.http=e;this.router=r;this.toastrService=t;this.platformId=o;this.isBrowser=h(this.platformId);let a=null;if(this.isBrowser){let n=localStorage.getItem("usuario");a=n?JSON.parse(n):null}this.currentUserSubject=new c(a),this.currentUser=this.currentUserSubject.asObservable()}currentUserSubject;currentUser;isBrowser;get getCurrentUserValue(){if(!this.currentUserSubject.value&&this.isBrowser){let e=localStorage.getItem("usuario");if(e){let r=JSON.parse(e);return this.currentUserSubject.next(r),r}}return this.currentUserSubject.value}login(e,r){return this.verifyCredentials(e,r).pipe(u(t=>{let o=t.payload.user;return o.access_token=t.payload.accessToken,this.currentUserSubject.next(o),this.isBrowser&&localStorage.setItem("token",t.payload.accessToken),o}),p(t=>(this.toastrService.danger("Login failed","Authentication Error"),l(()=>new Error("Login failed")))))}logout(){this.isBrowser&&(localStorage.removeItem("usuario"),localStorage.removeItem("token")),this.currentUserSubject.next(null),this.router.navigate(["/login"])}verifyCredentials(e,r){this.isBrowser&&localStorage.clear();let t=new v({Accept:"application/json","Content-Type":"application/json",email:e,password:r}),o=`${g.API_SEGURIDAD}/api/v1/auth/authenticate`;return this.http.post(o,{email:e,password:r},{headers:t})}clearUser(){this.isBrowser&&localStorage.clear(),this.currentUserSubject.next(null)}static \u0275fac=function(r){return new(r||s)(i(b),i(S),i(U),i(f))};static \u0275prov=m({token:s,factory:s.\u0275fac,providedIn:"root"})};export{j as a};
