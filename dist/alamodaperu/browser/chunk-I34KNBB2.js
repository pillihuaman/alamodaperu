import{a as We,b as j}from"./chunk-E5L23D6D.js";import{a as $e}from"./chunk-FWOGSU6V.js";import{a as V}from"./chunk-KHQMTLPU.js";import"./chunk-GJEU6FZM.js";import{a as Le}from"./chunk-SQZJFXB2.js";import{a as Qe}from"./chunk-K5HXVKPS.js";import{a as ze}from"./chunk-C4MTUD5M.js";import{a as P}from"./chunk-X3J7YRVF.js";import"./chunk-2FA2V676.js";import{a as h}from"./chunk-SGZVPLXZ.js";import"./chunk-ELOWQZB7.js";import{$a as te,$c as _e,Aa as m,Ab as A,Bb as re,C as $,Cb as ae,Ea as J,Fa as K,Fd as y,Ga as X,Gb as le,Gd as we,H as Q,Ha as Y,Hd as Ie,I as f,Ia as b,Ib as se,Id as Pe,J as g,Ja as Z,Jd as Re,Ka as B,Kb as ce,Kd as Fe,Ld as Oe,Md as Ge,Nd as ke,Od as He,P as _,Pd as Be,Qb as de,Qc as ue,Qd as Ae,Rc as M,Rd as Ve,Sb as pe,Sd as je,Tb as me,Tc as be,Td as qe,Ua as ee,Vc as he,Wc as fe,Xc as x,Y as d,Yc as ge,Zd as I,aa as W,ab as ne,ad as Ce,ba as u,cd as ye,db as ie,ea as N,fb as E,ha as U,ia as T,id as w,j as q,jd as Te,k as S,la as p,ld as De,md as ve,n as O,nd as Se,od as Ne,pd as Ee,rd as Me,s as G,sa as l,sd as xe,ta as a,ua as C,va as k,wa as H,x as z,xa as v,z as L,za as c,zb as oe}from"./chunk-HKEP7HVR.js";var Ze=["tableHeader"];function et(r,n){r&1&&C(0,"tr",20,1)}function tt(r,n){r&1&&C(0,"tr",21)}function nt(r,n){r&1&&(l(0,"th",22),b(1,"Acciones"),a())}function it(r,n){if(r&1){let e=v();l(0,"td",23)(1,"nb-icon",24),c("click",function(){let t=f(e).$implicit,o=m(3);return g(o.onEdit(t))}),a(),l(2,"nb-icon",25),c("click",function(){let t=f(e).$implicit,o=m(3);return g(o.onDelete(t))}),a()()}}function ot(r,n){if(r&1){let e=v();l(0,"th",28),c("click",function(){f(e);let t=m().$implicit,o=m(3);return g(o.updateSort({column:t,direction:o.getNextSortDirection(t)}))}),b(1),C(2,"nb-icon",29),a()}if(r&2){let e=m().$implicit,i=m(3);p("nbSortHeader",e),d(),B(" ",e," "),d(),p("icon",i.getSortIcon(e))}}function rt(r,n){if(r&1&&(l(0,"td",30),b(1),a()),r&2){let e=n.$implicit,i=m().$implicit;d(),Z(e.data[i]||"-")}}function at(r,n){if(r&1&&(k(0,9),T(1,ot,3,3,"th",26)(2,rt,2,1,"td",27),H()),r&2){let e=n.$implicit;p("nbTreeGridColumnDef",e)}}function lt(r,n){if(r&1){let e=v();l(0,"div")(1,"table",6),c("sort",function(t){f(e);let o=m(2);return g(o.updateSort(t))}),T(2,et,2,0,"tr",7)(3,tt,1,0,"tr",8),k(4,9),T(5,nt,2,0,"th",10)(6,it,3,0,"td",11),H(),T(7,at,3,1,"ng-container",12),a(),l(8,"div",13)(9,"button",14),c("click",function(){f(e);let t=m(2);return g(t.onLoadMore())}),C(10,"nb-icon",15),a(),l(11,"button",16),c("click",function(){f(e);let t=m(2);return g(t.onPageChange(t.currentPage-1))}),C(12,"nb-icon",17),a(),l(13,"span"),b(14),a(),l(15,"button",16),c("click",function(){f(e);let t=m(2);return g(t.onPageChange(t.currentPage+1))}),C(16,"nb-icon",18),a(),l(17,"button",14),c("click",function(){f(e);let t=m(2);return g(t.onLoadMore())}),C(18,"nb-icon",19),a()()()}if(r&2){let e=m(2);d(),p("nbTreeGrid",e.dataSource)("nbSort",e.dataSource),d(),p("nbTreeGridHeaderRowDef",e.getHeaderColumns()),d(),p("nbTreeGridRowDefColumns",e.getRowColumns()),d(),p("nbTreeGridColumnDef","acciones"),d(3),p("ngForOf",e.defaultColumns),d(4),p("disabled",e.currentPage===1),d(3),B("Page ",e.currentPage,""),d(),p("disabled",e.filteredData.length<=e.currentPage*e.pageSize)}}function st(r,n){r&1&&(l(0,"div",31)(1,"p"),b(2,"No data available. Please add some entries or adjust your search."),a()())}function ct(r,n){if(r&1){let e=v();l(0,"nb-card")(1,"nb-card-body")(2,"label",3),b(3,"Search:"),a(),l(4,"input",4),c("input",function(t){f(e);let o=m();return g(o.onSearch(t))}),a(),T(5,lt,19,9,"div",5)(6,st,3,0,"ng-template",null,0,ee),a()()}if(r&2){let e=Y(7),i=m();d(5),p("ngIf",i.filteredData.length>0)("ngIfElse",e)}}var R=class r{constructor(n,e){this.dataSourceBuilder=n;this.renderer=e;this.dataSource=this.dataSourceBuilder.create([])}defaultColumns=[];datas;typeOfSearch;isdelelete;hasMorePages=!0;pageChange=new _;pageSizeChange=new _;dataChange=new _;deleteAction=new _;editAction=new _;noData=new _;loadMoreData=new _;tableHeader;allColumns=["acciones",...this.defaultColumns];dataSource;filteredDataSource=[];sortColumn;sortDirection=y.NONE;pageSize=h.pageSizeTable;currentPage=h.currentPageTable;allData=[];filteredData=[];paginatedData=[];showTable=!1;searchTerm="";ngOnInit(){this.initializeData()}ngOnChanges(n){n.datas?.currentValue&&this.updateTableData(),this.isdelelete?.data?.ID!==void 0&&this.deleteItem()}initializeData(){this.allData=[...this.datas||[]],this.filteredData=[...this.datas||[]],this.buildTable()}updateTableData(){this.allData=[...this.datas||[]],this.filteredData=[...this.datas||[]],this.showTable=this.datas?.length>0,this.noData.emit(!this.showTable),this.buildTable()}deleteItem(){let n=this.isdelelete.data.ID;this.allData=this.allData.filter(e=>e.data.ID!==n),this.filteredData=this.filteredData.filter(e=>e.data.ID!==n),this.dataChange.emit(this.filteredData),this.buildTable()}buildTable(){let n=(this.currentPage-1)*this.pageSize,e=n+this.pageSize;this.paginatedData=this.filteredData.slice(n,e),this.dataSource=this.dataSourceBuilder.create(this.paginatedData)}onSearch(n){let e=n.target;this.searchTerm=e.value.trim().toLowerCase(),this.filteredData=this.searchTerm?this.allData.filter(i=>Object.values(i.data).some(t=>t?.toString().toLowerCase().includes(this.searchTerm))):[...this.allData],this.currentPage=1,this.buildTable()}updateSort(n){this.sortColumn=n.column,this.sortDirection=n.direction}getSortDirection(n){return this.sortColumn===n?this.sortDirection:y.NONE}onEdit(n){this.editAction.emit(n)}onDelete(n){this.deleteAction.emit(n)}onPageChange(n){this.currentPage=n,this.buildTable()}getHeaderColumns(){return[...this.defaultColumns,"acciones"]}getRowColumns(){return[...this.defaultColumns,"acciones"]}getNextSortDirection(n){return this.sortColumn!==n?y.ASCENDING:this.sortDirection===y.ASCENDING?y.DESCENDING:y.NONE}getSortIcon(n){return this.sortColumn!==n?"swap-outline":this.sortDirection===y.ASCENDING?"arrow-up-outline":"arrow-down-outline"}onLoadMore(){this.loadMoreData.emit(500)}static \u0275fac=function(e){return new(e||r)(u(Pe),u(W))};static \u0275cmp=N({type:r,selectors:[["app-table-datasource"]],viewQuery:function(e,i){if(e&1&&J(Ze,7),e&2){let t;K(t=X())&&(i.tableHeader=t.first)}},inputs:{defaultColumns:"defaultColumns",datas:"datas",typeOfSearch:"typeOfSearch",isdelelete:"isdelelete",hasMorePages:"hasMorePages"},outputs:{pageChange:"pageChange",pageSizeChange:"pageSizeChange",dataChange:"dataChange",deleteAction:"deleteAction",editAction:"editAction",noData:"noData",loadMoreData:"loadMoreData"},features:[Q],decls:1,vars:1,consts:[["noDataTemplate",""],["tableHeader",""],[4,"ngIf"],["for","search",1,"search-label"],["nbInput","","id","search",1,"search-input",3,"input"],[4,"ngIf","ngIfElse"],[3,"sort","nbTreeGrid","nbSort"],["nbTreeGridHeaderRow","",4,"nbTreeGridHeaderRowDef"],["nbTreeGridRow","",4,"nbTreeGridRowDef","nbTreeGridRowDefColumns"],[3,"nbTreeGridColumnDef"],["nbTreeGridHeaderCell","",4,"nbTreeGridHeaderCellDef"],["nbTreeGridCell","","class","actions-cell",4,"nbTreeGridCellDef"],[3,"nbTreeGridColumnDef",4,"ngFor","ngForOf"],[1,"pagination-container"],["nbButton","","ghost","",3,"click"],["icon","rewind-left-outline"],["nbButton","","ghost","",3,"click","disabled"],["icon","chevron-left"],["icon","chevron-right"],["icon","rewind-right-outline"],["nbTreeGridHeaderRow",""],["nbTreeGridRow",""],["nbTreeGridHeaderCell",""],["nbTreeGridCell","",1,"actions-cell"],["icon","edit-outline",3,"click"],["icon","trash-outline",3,"click"],["nbTreeGridHeaderCell","",3,"nbSortHeader","click",4,"nbTreeGridHeaderCellDef"],["nbTreeGridCell","",4,"nbTreeGridCellDef"],["nbTreeGridHeaderCell","",3,"click","nbSortHeader"],[3,"icon"],["nbTreeGridCell",""],[1,"no-data-container"]],template:function(e,i){e&1&&T(0,ct,8,2,"nb-card",2),e&2&&p("ngIf",i.showTable)},dependencies:[E,te,ne,I,x,he,be,w,ue,Re,Fe,He,Ge,Ve,Oe,Be,ke,je,Ae,we,Ie,qe,M],styles:["button[nbTreeGridRowToggle][_ngcontent-%COMP%]{background:transparent;border:none;padding:0}.search-label[_ngcontent-%COMP%]{display:block}.search-input[_ngcontent-%COMP%]{margin-bottom:1rem}.nb-tree-grid[_ngcontent-%COMP%], .nb-tree-grid-header[_ngcontent-%COMP%]{height:auto;width:auto}.header[_ngcontent-%COMP%]{text-align:center;background-color:#1485b9;color:#f0f8ff}th.nbTreeGridHeaderCell[ng-reflect-nbTreeGridColumnDef=acciones][_ngcontent-%COMP%], td.nbTreeGridCell[ng-reflect-nbTreeGridColumnDef=acciones][_ngcontent-%COMP%]{width:10%;display:flex;align-items:center}button[nbButton][_ngcontent-%COMP%]{margin-right:.5rem;font-size:.5rem}@media screen and (max-width: 600px){th.nbTreeGridHeaderCell[ng-reflect-nbTreeGridColumnDef=acciones][_ngcontent-%COMP%], td.nbTreeGridCell[ng-reflect-nbTreeGridColumnDef=acciones][_ngcontent-%COMP%]{width:100%}button[nbButton][_ngcontent-%COMP%]{display:block;margin-bottom:.5rem}}.pagination-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;margin-top:10px}.pagination[_ngcontent-%COMP%]{display:flex;align-items:center}.pagination[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0 5px}.no-data-container[_ngcontent-%COMP%]{text-align:center;font-size:16px;font-weight:700;color:#999;margin:20px 0}.table-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;max-height:500px}.table-header[_ngcontent-%COMP%]{position:sticky;top:0;background:#1485b9;color:#fff;z-index:100}.table-header[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.table-header[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:10px;text-align:left;background:#1485b9;color:#fff;font-weight:700}.table-body[_ngcontent-%COMP%]{overflow-y:auto;max-height:350px}.table-body[_ngcontent-%COMP%]   table[_ngcontent-%COMP%], table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.nb-tree-grid[_ngcontent-%COMP%]{display:block;overflow-y:auto;max-height:350px}.nb-tree-grid-header[_ngcontent-%COMP%]{position:sticky;top:0;z-index:100;background:#1485b9;color:#fff}"]})};var F=class r{constructor(n){this.supportRepository=n}employeesSubject=new q([]);employees$=this.employeesSubject.asObservable();fetchEmployees(n,e,i,t,o,s){this.supportRepository.findEmployee(n,e,i,t,o,s).subscribe(D=>{this.employeesSubject.next(D.payload)})}reloadEmployees(){this.employeesSubject.next(this.employeesSubject.value)}static \u0275fac=function(e){return new(e||r)($(P))};static \u0275prov=L({token:r,factory:r.\u0275fac,providedIn:"root"})};var Je=class r extends We{constructor(e,i,t,o,s,D,mt,ut){super();this.fb=e;this.supportService=i;this.modalRepository=t;this.dialogService=o;this.spinnerService=s;this.datePipe=D;this.employeeService=mt;this.modalService=ut;this.employeRequest={finishDateFormatted:"",startDateFormatted:""}}employeRequestForm;employeRequest;datas=[];teestMod="tees";isModalVisible=!1;isLoading=!1;isdelelete;searchButtonDisabled=!0;typeOfSearch;listError;deleteAction=new _;defaultColumnsInput=["id","name","lastName","document","startDate","finishDate","totalHours","total"];columnMappin(){return{id:"ID",name:"Name",lastName:"Last Name",startDate:"Start Date",finishDate:"Finish Date",totalHours:"Total Hours",total:"Total",document:"Document"}}isRegisterEmployeeExpanded=!1;hasMorePagesT=!0;processDataResult;formatDate(e){return this.datePipe.transform(e,"dd/MM/yyyy")||""}ngOnInit(){this.page=1,this.buildForm(),this.employeeService.employees$.subscribe(e=>{this.datas=this.customizePropertyNames(e,this.columnMappin()),this.datas&&this.datas.length>0?(this.defaultColumnsInput=Object.keys(this.datas[0].data),this.updateHasMorePagesT(!0)):this.updateHasMorePagesT(!1),this.spinnerService.hide()}),this.findEmproyeeProcess()}findByDefualtg(){let e=this.employeRequestForm.value.idToFind||"",i=this.employeRequestForm.value.nameToFind||"",t=this.employeRequestForm.value.lastNameToFind||"",o=this.employeRequestForm.value.documentToFind||"";this.employeeService.fetchEmployees(this.page??h.page,this.pageSize??h.perPage,e,i,t,o)}deleting(e){debugger;let i={data:e.data,description:e.data.Name,typeDescription:"QUESTION".toString()};this.dialogService.open(Le,{context:{rowData:i}}).componentRef.instance.deleteConfirmed.subscribe(()=>{this.handleDeleteAction(e)})}isNewPage(){return!this.employeRequestForm.get("id")?.value}buildForm(){this.employeRequestForm=this.fb.group({id:[""],name:["",A.required],lastName:[""],startDate:[""],finishDate:[""],document:["",A.required],typeDocument:[""],salaryHours:[""],idToFind:[""],nameToFind:[""],lastNameToFind:[""],documentToFind:[""]})}findEmproyeeProcess(){this.spinnerService.show();let e=this.employeRequestForm.value.idToFind||"",i=this.employeRequestForm.value.nameToFind||"",t=this.employeRequestForm.value.lastNameToFind||"",o=this.employeRequestForm.value.documentToFind||"";this.supportService.findEmployee(this.page,this.pageSize,e,i,t,o).pipe(O(s=>{let D=s?.payload||[];return this.customizePropertyNames(D,this.columnMappin())}),G(s=>{debugger;return console.error("Error fetching employees:",s),S([])})).subscribe(s=>{this.datas=s,console.log("Data source page",this.datas);debugger;this.datas&&this.datas.length>0?(this.defaultColumnsInput=Object.keys(this.datas[0].data),this.updateHasMorePagesT(!0)):(this.updateHasMorePagesT(!1),this.showNoDataMessage()),this.spinnerService.hide()})}showNoDataMessage(){let e="warning"}handleDeleteAction(e){if(console.log("Deleting:",e),e.data.ID!==void 0){let i=e.data.ID;this.supportService.deleteEmployee(i).subscribe(t=>{this.modalRepository.showToast("success","delete Succes","Succes"),this.spinnerService.hide(),this.isdelelete=e},t=>{debugger;(t.status===422||t.status===500)&&t.error&&t.error.data&&t.error.data.payload&&t.error.data.payload.forEach(o=>{let s=o.propertyPath,D=o.valExceptionDescription;this.employeRequestForm.get(s)?.setErrors({invalid:!0,customError:D})}),this.spinnerService.hide()})}}handleEditicionAction(e){if(!e?.data?.ID){console.warn("Invalid employee data.");return}let i=e.data.ID;this.supportService.findEmployee(1,1,i,"","","").pipe(O(t=>t.payload?.[0]||null),G(t=>(console.error("Error fetching employee:",t),S(null))),z(t=>t?this.dialogService.open(V,{context:{employeeData:t},closeOnBackdropClick:!1,hasBackdrop:!0}).onClose:(console.warn("Employee not found."),S(null)))).subscribe(t=>{debugger;t&&this.findEmproyeeProcess()})}onPageChange(e){super.onPageChange(e),console.log("EmployeeComponent onPageChange called with page:",e)}onPageSizeChange(e){}checkInputs(){let e=this.employeRequestForm.get("idToFind")?.value||"",i=this.employeRequestForm.get("nameToFind")?.value||"",t=this.employeRequestForm.get("lastNameToFind")?.value||"",o=this.employeRequestForm.get("documentToFind")?.value||"";this.searchButtonDisabled=!(e||i||t||o),this.searchButtonDisabled&&(this.page=h.page,this.typeOfSearch=h.typeSearchDefault,this.findEmproyeeProcess())}findByparameter(){this.listError=this.validateObjectID(),this.listError.length===0&&(this.employeRequestForm.get("idToFind")?.markAsTouched(),this.page=h.page,this.pageSize=h.perPage,this.typeOfSearch=h.typeSearchEspecific,this.findEmproyeeProcess())}findByDefualt(){this.typeOfSearch=h.typeSearchDefault,this.findEmproyeeProcess()}validateObjectID(){let e=this.employeRequestForm.get("idToFind")?.value||"",i=[],t=j.isValidObjectId(e);return j.empty(e)||t||i.push("ID is not valid."),i}updateHasMorePagesT(e){this.hasMorePagesT=e}onHasMorePagesTChange(e){}onNewClick(){this.dialogService.open(V,{context:{},closeOnBackdropClick:!1,hasBackdrop:!0,backdropClass:"custom-backdrop",dialogClass:"custom-dialog"}).onClose.subscribe(e=>{e&&this.findEmproyeeProcess()})}static \u0275fac=function(i){return new(i||r)(u(de),u(P),u(ze),u(Me),u(Qe),u(ie),u(F),u($e))};static \u0275cmp=N({type:r,selectors:[["app-employee"]],outputs:{deleteAction:"deleteAction"},features:[U],decls:25,vars:7,consts:[[1,"form-container"],[3,"formGroup"],["multi","true"],["expanded","true"],[1,"form-grid"],["nbInput","","fullWidth","","type","text","placeholder","ID","formControlName","idToFind",3,"input"],["nbInput","","fullWidth","","type","text","placeholder","Name","formControlName","nameToFind",3,"input"],["nbInput","","fullWidth","","type","text","placeholder","Last Name","formControlName","lastNameToFind",3,"input"],["nbInput","","fullWidth","","type","text","placeholder","Document","formControlName","documentToFind",3,"input"],[1,"button-container"],["nbButton","","status","primary",3,"click","disabled"],["nbButton","","status","success",3,"click"],[3,"pageChange","pageSizeChange","deleteAction","editAction","loadMoreData","noData","datas","defaultColumns","isdelelete","hasMorePages","typeOfSearch"]],template:function(i,t){i&1&&(l(0,"nb-layout")(1,"nb-layout-column")(2,"div",0)(3,"form",1)(4,"nb-accordion",2)(5,"nb-accordion-item",3)(6,"nb-accordion-item-header"),b(7," Search Information "),a(),l(8,"nb-accordion-item-body")(9,"div",4)(10,"input",5),c("input",function(){return t.checkInputs()}),a(),l(11,"input",6),c("input",function(){return t.checkInputs()}),a(),l(12,"input",7),c("input",function(){return t.checkInputs()}),a(),l(13,"input",8),c("input",function(){return t.checkInputs()}),a()(),l(14,"div",9)(15,"button",10),c("click",function(){return t.findByparameter()}),b(16," Search "),a(),l(17,"button",11),c("click",function(){return t.onNewClick()}),b(18," New "),a()()()()(),l(19,"nb-accordion",2)(20,"nb-accordion-item",3)(21,"nb-accordion-item-header"),b(22," Data Information "),a(),l(23,"nb-accordion-item-body")(24,"app-table-datasource",12),c("pageChange",function(s){return t.onPageChange(s)})("pageSizeChange",function(s){return t.onPageSizeChange(s)})("deleteAction",function(s){return t.deleting(s)})("editAction",function(s){return t.handleEditicionAction(s)})("loadMoreData",function(){return t.findEmproyeeProcess()})("noData",function(){return t.showNoDataMessage()}),a()()()()()()()()),i&2&&(d(3),p("formGroup",t.employeRequestForm),d(12),p("disabled",t.searchButtonDisabled),d(9),p("datas",t.datas)("defaultColumns",t.defaultColumnsInput)("isdelelete",t.isdelelete)("hasMorePages",t.hasMorePagesT)("typeOfSearch",t.typeOfSearch))},dependencies:[E,me,le,oe,re,ae,se,ce,ge,x,fe,Te,w,M,pe,xe,ye,_e,Ce,Ee,De,ve,Ne,Se,I,R],styles:[".form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:16px}.button-container[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:12px;margin-top:16px}"]})};export{Je as EmployeeComponent};
