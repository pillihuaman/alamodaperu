import{a as E}from"./chunk-MYIS6U52.js";import{a as pe,b as C}from"./chunk-74SYO77B.js";import{a as re}from"./chunk-U2AMN5GA.js";import{c as se}from"./chunk-LQ2CNIKZ.js";import"./chunk-X7ITCY6U.js";import{a as ae}from"./chunk-7CCSDLUV.js";import{a as l}from"./chunk-SGZVPLXZ.js";import{a as g}from"./chunk-X3J7YRVF.js";import{a as ne}from"./chunk-C4MTUD5M.js";import"./chunk-MIA7GIEB.js";import"./chunk-LGA5V4LE.js";import{Ab as j,C as T,Eb as B,Gb as O,Ha as c,Ib as A,Ob as w,Pc as G,Qb as z,Rb as H,Uc as L,Vc as V,Vd as ie,Wc as x,Z as h,Zc as W,_c as $,ad as U,ba as s,bb as R,da as I,db as P,ga as M,gd as J,hd as K,j as F,jd as Q,k as f,ka as y,kd as X,ld as Y,md as Z,n as v,nd as ee,pd as te,qd as oe,ra as r,s as S,sa as a,x as D,xb as k,ya as p,yb as _,z as N,zb as q}from"./chunk-AQOSOR55.js";var b=class m{constructor(u){this.supportRepository=u}employeesSubject=new F([]);employees$=this.employeesSubject.asObservable();fetchEmployees(u,t,i,e,o,n){this.supportRepository.findEmployee(u,t,i,e,o,n).subscribe(d=>{this.employeesSubject.next(d.payload)})}reloadEmployees(){this.employeesSubject.next(this.employeesSubject.value)}static \u0275fac=function(t){return new(t||m)(T(g))};static \u0275prov=N({token:m,factory:m.\u0275fac,providedIn:"root"})};var le=class m extends se{constructor(t,i,e,o,n,d,fe,me){super(me,e,o);this.fb=t;this.supportService=i;this.datePipe=n;this.employeeService=d;this.modalService=fe;this.employeRequest={finishDateFormatted:"",startDateFormatted:""}}employeRequestForm;employeRequest;datas=[];teestMod="tees";isModalVisible=!1;isLoading=!1;isdelelete;searchButtonDisabled=!0;typeOfSearch;listError;columnMappin(){return{id:"ID",name:"Name",lastName:"Last Name",startDate:"Start Date",finishDate:"Finish Date",totalHours:"Total Hours",total:"Total",document:"Document"}}ngOnInit(){this.buildForm(),this.loadEmployees(),this.findEmproyeeProcess()}loadEmployees(){this.employeeService.employees$.subscribe(t=>{this.processEmployeeData(t),this.spinnerService.hide()})}processEmployeeData(t){this.datas=this.customizePropertyNames(t,this.columnMappin()),this.setDefaultColumns(this.datas),this.datas&&this.datas.length>0?this.updateHasMorePagesT(!0):this.updateHasMorePagesT(!1)}findByDefualtg(){let t=this.employeRequestForm.value.idToFind||"",i=this.employeRequestForm.value.nameToFind||"",e=this.employeRequestForm.value.lastNameToFind||"",o=this.employeRequestForm.value.documentToFind||"";this.employeeService.fetchEmployees(this.page??l.page,this.pageSize??l.perPage,t,i,e,o)}deleting(t){this.openDeleteModal(t).componentRef.instance.deleteConfirmed.subscribe(()=>{this.handleDeleteAction(t)})}buildForm(){this.employeRequestForm=this.fb.group({id:[""],name:["",_.required],lastName:[""],startDate:[""],finishDate:[""],document:["",_.required],typeDocument:[""],salaryHours:[""],idToFind:[""],nameToFind:[""],lastNameToFind:[""],documentToFind:[""]})}findEmproyeeProcess(){this.spinnerService.show();let t=this.employeRequestForm.value.idToFind||"",i=this.employeRequestForm.value.nameToFind||"",e=this.employeRequestForm.value.lastNameToFind||"",o=this.employeRequestForm.value.documentToFind||"";this.supportService.findEmployee(this.page,this.pageSize,t,i,e,o).pipe(v(n=>{let d=n?.payload||[];return this.customizePropertyNames(d,this.columnMappin())}),S(n=>{debugger;return console.error("Error fetching employees:",n),f([])})).subscribe(n=>{this.datas=n,console.log("Data source page",this.datas);debugger;this.setDefaultColumns(this.datas),this.datas&&this.datas.length>0?this.updateHasMorePagesT(!0):this.updateHasMorePagesT(!1),this.spinnerService.hide()})}handleDeleteAction(t){if(console.log("Deleting:",t),t.data.ID!==void 0){let i=t.data.ID;this.supportService.deleteEmployee(i).subscribe(e=>{this.showSuccessMessage("Delete Success","Success"),this.isdelelete=t},e=>{debugger;(e.status===422||e.status===500)&&e.error&&e.error.data&&e.error.data.payload&&e.error.data.payload.forEach(o=>{let n=o.propertyPath,d=o.valExceptionDescription;this.employeRequestForm.get(n)?.setErrors({invalid:!0,customError:d})}),this.spinnerService.hide()})}}handleEditicionAction(t){if(!t?.data?.ID){console.warn("Invalid employee data.");return}let i=t.data.ID;this.supportService.findEmployee(1,1,i,"","","").pipe(v(e=>e.payload?.[0]||null),S(e=>(console.error("Error fetching employee:",e),f(null))),D(e=>e?this.dialogService.open(E,{context:{entityData:e},closeOnBackdropClick:!1,hasBackdrop:!0}).onClose:(console.warn("Employee not found."),f(null)))).subscribe(e=>{debugger;e&&this.findEmproyeeProcess()})}checkInputs(){let t=this.employeRequestForm.get("idToFind")?.value||"",i=this.employeRequestForm.get("nameToFind")?.value||"",e=this.employeRequestForm.get("lastNameToFind")?.value||"",o=this.employeRequestForm.get("documentToFind")?.value||"";this.searchButtonDisabled=!(t||i||e||o),this.searchButtonDisabled&&(this.page=l.page,this.typeOfSearch=l.typeSearchDefault,this.findEmproyeeProcess())}findByparameter(){this.listError=this.validateObjectID(),this.listError.length===0&&(this.employeRequestForm.get("idToFind")?.markAsTouched(),this.page=l.page,this.pageSize=l.perPage,this.typeOfSearch=l.typeSearchEspecific,this.findEmproyeeProcess())}findByDefualt(){this.findEmproyeeProcess()}validateObjectID(){let t=this.employeRequestForm.get("idToFind")?.value||"",i=[],e=C.isValidObjectId(t);return C.empty(t)||e||i.push("ID is not valid."),i}onNewClick(){this.dialogService.open(E,{context:{},closeOnBackdropClick:!1,hasBackdrop:!0,backdropClass:"custom-backdrop",dialogClass:"custom-dialog"}).onClose.subscribe(t=>{t&&this.findEmproyeeProcess()})}static \u0275fac=function(i){return new(i||m)(s(w),s(g),s(ne),s(ae),s(R),s(b),s(re),s(te))};static \u0275cmp=I({type:m,selectors:[["app-employee"]],features:[M],decls:25,vars:7,consts:[[1,"form-container"],[3,"formGroup"],["multi","true"],["expanded","true"],[1,"form-grid"],["nbInput","","fullWidth","","type","text","placeholder","ID","formControlName","idToFind",3,"input"],["nbInput","","fullWidth","","type","text","placeholder","Name","formControlName","nameToFind",3,"input"],["nbInput","","fullWidth","","type","text","placeholder","Last Name","formControlName","lastNameToFind",3,"input"],["nbInput","","fullWidth","","type","text","placeholder","Document","formControlName","documentToFind",3,"input"],[1,"button-container"],["nbButton","","status","primary",3,"click","disabled"],["nbButton","","status","success",3,"click"],[3,"pageChange","pageSizeChange","deleteAction","editAction","loadMoreData","noData","datas","defaultColumns","isdelelete","hasMorePages","typeOfSearch"]],template:function(i,e){i&1&&(r(0,"nb-layout")(1,"nb-layout-column")(2,"div",0)(3,"form",1)(4,"nb-accordion",2)(5,"nb-accordion-item",3)(6,"nb-accordion-item-header"),c(7," Search Information "),a(),r(8,"nb-accordion-item-body")(9,"div",4)(10,"input",5),p("input",function(){return e.checkInputs()}),a(),r(11,"input",6),p("input",function(){return e.checkInputs()}),a(),r(12,"input",7),p("input",function(){return e.checkInputs()}),a(),r(13,"input",8),p("input",function(){return e.checkInputs()}),a()(),r(14,"div",9)(15,"button",10),p("click",function(){return e.findByparameter()}),c(16," Search "),a(),r(17,"button",11),p("click",function(){return e.onNewClick()}),c(18," New "),a()()()()(),r(19,"nb-accordion",2)(20,"nb-accordion-item",3)(21,"nb-accordion-item-header"),c(22," Data Information "),a(),r(23,"nb-accordion-item-body")(24,"app-table-datasource",12),p("pageChange",function(n){return e.onPageChange(n)})("pageSizeChange",function(n){return e.onPageSizeChange(n)})("deleteAction",function(n){return e.deleting(n)})("editAction",function(n){return e.handleEditicionAction(n)})("loadMoreData",function(){return e.findEmproyeeProcess()})("noData",function(){return e.showNoDataMessage()}),a()()()()()()()()),i&2&&(h(3),y("formGroup",e.employeRequestForm),h(12),y("disabled",e.searchButtonDisabled),h(9),y("datas",e.datas)("defaultColumns",e.defaultColumnsInput)("isdelelete",e.isdelelete)("hasMorePages",e.hasMorePagesT)("typeOfSearch",e.typeOfSearch))},dependencies:[P,H,B,k,q,j,O,A,x,V,L,K,J,G,z,oe,U,W,$,ee,Q,X,Z,Y,ie,pe],styles:[".form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:16px}.button-container[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:12px;margin-top:16px}"]})};export{le as EmployeeComponent};
